<div id="tracks-container">
{% if tracks %}
    <ol class="flex flex-col gap-4">
    {% set seen_albums = {} %}
    {% for track in tracks %}
        <li>
            <div class="flex items-center gap-4 p-3 bg-[#181e1b] rounded-lg shadow hover:shadow-lg transition-shadow">
                {% if track.album and track.album.images and track.album.images[0].url %}
                    <img src="{{ track.album.images[0].url }}" alt="album cover" class="w-12 h-12 rounded object-cover" />
                {% endif %}
                <span class="flex-1 min-w-0">
                    <strong class="text-white truncate">{{ track.name }}</strong>
                    <span class="block text-[#9eb7a8] text-sm truncate">{{ track.artists | map(attribute='name') | join(', ') }}</span>
                    {% if track.external_urls.spotify %}
                        <a href="{{ track.external_urls.spotify }}" target="_blank" class="text-[#38e07b] text-xs underline">(Open in Spotify)</a>
                    {% endif %}
                </span>
                <form hx-post="/add_track_to_library/{{ track.id }}" hx-target="#add-track-{{ track.id }}" hx-swap="innerHTML">
                    <button type="submit" class="rounded-full bg-[#38e07b] text-[#111714] px-3 py-1 font-bold text-xs shadow hover:bg-[#2ed16a] transition-colors">Add</button>
                </form>
                <div id="add-track-{{ track.id }}"></div>
                {% if track.album and track.album.id and track.album.id not in seen_albums and not saved_albums.get(track.album.id, False) %}
                    {% set _ = seen_albums.update({track.album.id: True}) %}
                    <form hx-post="/add_album_to_library/{{ track.album.id }}" hx-target="#add-album-{{ track.album.id }}" hx-swap="innerHTML">
                        <button type="submit" class="rounded-full bg-[#29382f] text-white px-3 py-1 font-bold text-xs shadow hover:bg-[#395645] transition-colors">Add Album</button>
                    </form>
                    <div id="add-album-{{ track.album.id }}"></div>
                {% endif %}
            </div>
        </li>
    {% endfor %}
    </ol>
    <div class="flex items-center justify-center gap-4 mt-6" role="navigation" aria-label="Track pagination">
        {% if prev_offset is not none %}
            <button hx-get="{{ url_for('playlist_detail', playlist_id=playlist.id) }}?offset={{ prev_offset }}" hx-target="#tracks-container" hx-swap="outerHTML" class="px-4 py-2 rounded bg-[#29382f] text-[#9eb7a8] focus:outline-none focus:ring-2 focus:ring-[#38e07b]" aria-label="Previous tracks page">Previous</button>
        {% endif %}
        <span class="text-[#9eb7a8] text-base">Tracks {{ offset + 1 }}-{{ offset + tracks|length }} of {{ total_tracks }}</span>
        {% if next_offset is not none %}
            <button hx-get="{{ url_for('playlist_detail', playlist_id=playlist.id) }}?offset={{ next_offset }}" hx-target="#tracks-container" hx-swap="outerHTML" class="px-4 py-2 rounded bg-[#38e07b] text-[#181e1b] font-bold focus:outline-none focus:ring-2 focus:ring-[#38e07b]" aria-label="Next tracks page">Next</button>
        {% endif %}
    </div>
{% else %}
    <p class="text-[#9eb7a8] py-8 text-center">No tracks found.</p>
{% endif %}
</div>

